# 브라우저 동작 원리

구글의 Chrome V8 자바스크립트 엔진으로 빌드된 자바스크립트 런타임환경인 *Node.js* 의 등장으로 자바스크립트는 웹 브라우저 외에도 서버 사이드 어플리케이션 개발에도 사용되는 범용 개발 언어가 되었습니다.

그래도 자바스크립트가 가장 많이 사용되는 분야는 역시 자바스크립트의 고향인 웹 브라우저 환경에서 동작하는 웹 페이지/어플리케이션입니다. 

대부분의 프로그래밍 언어는 OS 위에서 실행되나, 웹 어플리케이션 상의 자바스크립트는 브라우저에서 HTML, CSS와 함께 실행됩니다. 따라서 브라우저 환경을 고려하며 프로그래밍 할 때 더욱 효율적으로 자바스크립트 프로그래밍을 할 수 있을 것 입니다.

브라우저의 핵심 기능은 사용자가 참조하고자 하는 웹 페이지를 서버에 Request하고 서버의 Response를 받아 브라우저에 표시하는 것 입니다. 브라우저는 서버로부터 HTML, CSS, Javascript, 이미지 파일 등의 자원들을 응답받고, HTML, CSS 파일은 렌더링 엔진의 HTML paser와 CSS paser에 의해 Parsing되어 DOM, CSSOM 트리로 변환되고 렌더 트리로 결합됩니다. 이렇게 생성된 렌더 트리를 기반으로 브라우저는 웹 페이지를 띄워주고요. 이러한 자원의 주소는 URI에 의해 정해집니다.

![브라우저 동작 원리](https://github.com/leafcis/TIL/blob/master/Src/client-server.png?raw=true)

자바스크립트는 자바스크립트 엔진이 처리합니다. HTML paser는 script 태그를 만나면 자바스크립트 코드를 실행하기 위해 DOM 생성 프로세스를 중지하고 자바스크립트 엔진으로 제어 권한을 넘기는데, 제어권한을 넘겨 받은 자바스크립트 엔진은 script 태그 내 자바스크립트 코드 또는 script 태그의 src attribute에 정의된 자바스크립트 파일을 로드하고 파싱하여 실행합니다. 자바스크립트의 실행이 완료되고 나서야 다시 HTML paser로 제어 권한을 넘겨서 중지된 시점부터 DOM 생성을 재개하구요.

이처럼 브라우저는 동기적으로 HTML, CSS, Javascript를 처리합니다. 따라서 script 태그의 위치는 중요한 위치를 가지며 이는 DOM의 생성이 지연될 수 있기 때문입니다.

body 요소의 가장 하단에 자바스크립트를 위치시키는 것은 좋은 아이디어며, 그 이유는

* HTML 요소들이 스크립트 로딩 지연으로 렌더링에 지장 받는 일이 발생하지 않아 페이지 로딩 시간이 단축됨.
* DOM 이 완성되지 않은 상태에서 자바스크립트가 DOM을 조작한다면 에러가 발생함.

과 같습니다.



---



## 브라우저의 주요 기능 (UI)

브라우저의 사용자 인터페이스는 서로 닮아 있는데 

* URI를 입력할 수 있는 주소 표시 줄

* 이전 버튼과 다음 버튼
* 북마크
* 새로 고침 버튼과 현재 문서의 로드를 중단할 수 있는 정지 버튼
* 홈 버튼

등이 일반적이겠네요.

브라우저의 사용자 인터페이스는 표준 명세가 없음에도 수 년간 서로의 장점을 모방하며 현재에 이르게 되었습니다. HTML5 명세는 주소 표시줄, 상태 표시줄, 도구 모음과 같은 일반적인 요소를 제외하고 브라우저의 필수 UI를 정의하지 않았습니다. 



---



## 브라우저의 기본 구조

브라우저의 주요 구성 요소는

* 사용자 인터페이스 - 위 브라우저의 주요 기능에서 참고
* 브라우저 엔진 - 사용자 인터페이스와 렌더링 엔진 사이의 동작을 제어
* 렌더링 엔진 - 요청한 콘텐츠를 표시. 예를 들어 HTML을 요청하면 HTML과 CSS를 파싱하여 화면에 표시
* 통신 - HTTP 요청과 같은 네트워크 호출에 사용. 이는 플랫폼 독립적 인터페이스고 각 플랫폼 하부에서 실행.
* UI 백엔드 - 콤보 박스와 창 같은 기본적인 장치를 그림. 플랫폼에서 명시하지 않은 인터페이스로서, OS 사용자 인터페이스 체계를 사용.
* 자바스크립트 엔진 - 자바스크립트 코드를 실행함. 크롬에서는 V8엔진을 사용하고 있음
* 자료 저장소 - 자료를 저장하는 계층으로, 쿠키를 저장하는 것과 같이 모든 종류의 자원을 하드 디스크에 저장할 필요가 있음. HTML5 명세에는 브라우저가 지원하는 *웹 데이터 베이스*가 정의되어 있음

크롬은 대부분의 브라우저와 달리 각 탭마다 별도의 렌더링 엔진 인스턴스를 유지합니다. 각 탭은 독립된 프로세스로 처리되구요.



---



## 렌더링 엔진

렌더링 엔진의 역할은 요청 받은 내용을 브라우저 화면에 표시하는 일입니다.

렌더링 엔진은 HTML, CSS와 이미지를 표시할 수 있고, 플러그인이나 브라우저 확장 기능을 이용해 PDF와 같은 다른 유형도 표시할 수 있습니다.



### 렌더링 엔진들

파이어 폭스는 모질라에서 직접 만든 Gecko 엔진을 사용하고, 사파리와 크롬은 Webkit 엔진을 사용합니다.

Webkit은 최초 리눅스 플랫폼에서 동작하기 위해 제작된 오픈소스 엔진인데, 애플이 맥과 윈도우즈에서 사파리 브라우저를 지원하기 위해 수정을 가하게 되었습니다. http://webkit.org를 참조하십쇼!



### 동작 과정

렌더링 엔진은 통신으로부터 요청한 문서의 내용을 얻는 것으로 시작하는데 문서 내용은 보통 8KB 단위로 전송됩니다.

렌더링 엔진은 HTML 문서를 파싱하고 태그를 DOM 노드로 변환합니다. 그 다음 외부 CSS 파일과 함께 포함된 스타일 요소도 파싱하여 CSSOM 트리로 변환하고 이후 이를 합쳐 렌더 트리라는 또 다른 트리를 생성하게 됩니다.



### 동작과정 예

